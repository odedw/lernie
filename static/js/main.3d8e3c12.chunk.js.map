{"version":3,"sources":["config/parameterConfig.ts","engine/LFO.ts","engine/runHydra.ts","engine/Streams.ts","engine/state/defaultSourceState.ts","config/LaunchControlXL.ts","engine/setupMidi.ts","engine/engine.ts","storage/fileUtils.ts","components/Hydra.tsx","components/Scope.tsx","App.tsx","reportWebVitals.ts","init.ts","index.tsx","types/index.ts","types/source.ts","types/state.ts"],"names":["config","parameters","mod1","min","max","mod2","mod3","rotation","brightness","pixelate","scale","colorama","modulate","modulateRotate","modulateScale","repeatXY","blend","diff","feedback","selfModulate","sourceMods","SourceType","osc","noise","voronoi","screen","shape","LFO","time","Math","sin","getValueGenerator","ss","p","lfo","getValue","runSource","s","i","screenRatio","sources","o1","o2","getBuffersBySourceIndex","o","modulationSource","sourceType","contrast","s0","initScreen","src","color","rotate","PI","getSource","repeat","out","run","state","lfo1","solid","o0","Streams","parameterChange","Subject","lfoChange","sourceTypeChange","loadPreset","savePreset","defaultParams","defaultSourceMods","generateDefaultSourceState","primary","res","SourceState","cc","switchSource","note","reset","shift","presets","sourceSubscriptions","input","Input","create","bindSource","sourceIndex","mapping","refreshState","subjects","subs","Object","keys","map","k","key","isLfoPressed","channel","subscribe","e","value","next","parameter","unit","bindParameter","push","noteOn","Number","SourceTypeValues","length","filter","includes","forEach","type","defaultState","setupSources","unsubscribe","then","bindBoolean","noteOff","engine","streams","this","bind","preset","index","startsWith","random","cloneSourceState","rerun","some","gsap","to","duration","data","name","dataStr","encodeURIComponent","downloadAnchorNode","document","createElement","setAttribute","body","appendChild","click","remove","downloadObjectAsJson","JSON","stringify","moment","format","file","Promise","resolve","reject","reader","FileReader","addEventListener","event","target","result","readAsText","loadFile","str","parse","err","console","error","catch","Hydra","require","Canvas","styled","canvas","canvasRef","useRef","useState","hasRun","setHasRun","useEffect","current","w","window","innerWidth","h","innerHeight","width","height","setResolution","id","ref","Container","div","Text","timers","Scope","enabled","text1","setText1","text2","setText2","show","useCallback","text","force","setText","clearTimeout","setTimeout","sub","merge","pipe","toString","toFixed","floor","className","FileDrop","App","scopeEnabled","setScopeEnabled","evt","toLowerCase","saveProject","getElementById","randomize","accept","onChange","files","loadProject","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","init","ReactDOM","render","StrictMode","isNaN"],"mappings":"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","file":"static/js/main.3d8e3c12.chunk.js","sourcesContent":["import { Parameter, SourceType } from '../types';\n\nexport type Range = {\n  min: number;\n  max: number;\n};\nexport type ParameterConfig = {\n  parameters: Record<Parameter, Range>;\n  sourceMods: Record<SourceType, Record<'mod1' | 'mod2' | 'mod3', Range>>;\n};\n\nexport const config: ParameterConfig = {\n  parameters: {\n    mod1: { min: 0, max: 80 },\n    mod2: { min: -0.5, max: 0.5 },\n    mod3: { min: 0, max: 10 },\n    rotation: { min: 0, max: 6.283185307179586 },\n    brightness: { min: -1, max: 1 },\n    pixelate: { min: 10, max: 1500 },\n    scale: { min: 0.5, max: 7 },\n    colorama: { min: -0.001, max: 1 },\n    modulate: { min: -1, max: 1 },\n    modulateRotate: { min: -10, max: 10 },\n    modulateScale: { min: -10, max: 10 },\n    repeatXY: { min: 1, max: 8 },\n    blend: { min: 0, max: 1 },\n    diff: { min: 0, max: 1 },\n    feedback: { min: 0, max: 1 },\n    selfModulate: { min: 0, max: 1 },\n  },\n  sourceMods: {\n    [SourceType.osc]: {\n      mod1: { min: 0, max: 100 },\n      mod2: { min: -1, max: 1 },\n      mod3: { min: 0, max: 6.3 },\n    },\n    [SourceType.noise]: {\n      mod1: { min: 0, max: 1 },\n      mod2: { min: 0, max: 0.5 },\n      mod3: { min: 0, max: 10 },\n    },\n    [SourceType.voronoi]: {\n      mod1: { min: 0, max: 80 },\n      mod2: { min: 0, max: 10 },\n      mod3: { min: 0, max: 20 },\n    },\n    [SourceType.screen]: {\n      mod1: { min: 0, max: 1 },\n      mod2: { min: 0, max: 1 },\n      mod3: { min: 0, max: 1 },\n    },\n    [SourceType.shape]: {\n      mod1: { min: 1, max: 20 },\n      mod2: { min: 0, max: 1 },\n      mod3: { min: -100, max: 100 },\n    },\n  },\n};\n","export class LFO {\n  //   constructor() {}\n\n  getValue(time: number) {\n    return (Math.sin(time / 5) + 1) / 2;\n  }\n}\n","import { SourceState, SourceType, HydraStream, OutputBuffer, State, Parameter, CallbackObject } from '../types';\nimport { LFO } from './LFO';\nimport { config } from '../config/parameterConfig';\n\n// eslint-disable-next-line\nfunction debug(val: number): number {\n  console.log(val);\n  return val;\n}\n\nfunction getValueGenerator(ss: SourceState, p: Parameter, lfo: LFO): (co: CallbackObject) => number {\n  return ({ time }) => {\n    // console.log(\n    //   (lfo.getValue(time) * (config.parameters[p].max - config.parameters[p].min) + config.parameters[p].min) *\n    //     ss.lfo[p]\n    // );\n    return (\n      ss.parameters[p] +\n      (lfo.getValue(time) * (config.parameters[p].max - config.parameters[p].min) + config.parameters[p].min) *\n        ss.lfo[p]\n    );\n  };\n}\n\nfunction getSource(ss: SourceState, screenRatio: number, lfo: LFO): HydraStream {\n  if (ss.sourceType === SourceType.noise) {\n    return noise(80, getValueGenerator(ss, 'mod1', lfo))\n      .scale(1, 1, screenRatio)\n      .contrast(getValueGenerator(ss, 'mod2', lfo));\n    // .kaleid(getValueGenerator(ss, 'kaleid', lfo));\n  } else if (ss.sourceType === SourceType.voronoi) {\n    return voronoi(100, getValueGenerator(ss, 'mod1', lfo), getValueGenerator(ss, 'mod2', lfo)).scale(\n      1,\n      1,\n      screenRatio\n    );\n    // .kaleid(getValueGenerator(ss, 'kaleid', lfo));\n  } else if (ss.sourceType === SourceType.screen) {\n    s0.initScreen();\n    return (\n      src(s0)\n        // .saturate(getValueGenerator(ss, 'mod2', lfo))\n        .color(\n          getValueGenerator(ss, 'mod1', lfo),\n          getValueGenerator(ss, 'mod2', lfo),\n          getValueGenerator(ss, 'mod3', lfo)\n        )\n    );\n  } else if (ss.sourceType === SourceType.shape) {\n    return shape(getValueGenerator(ss, 'mod1', lfo), getValueGenerator(ss, 'mod2', lfo))\n      .scale(1, 1, screenRatio)\n      .rotate(({ time }) => ((time * ss.parameters.mod3) % 360) * (Math.PI / 180));\n  } else {\n    return osc(\n      getValueGenerator(ss, 'mod1', lfo),\n      getValueGenerator(ss, 'mod2', lfo),\n      getValueGenerator(ss, 'mod3', lfo)\n    );\n    // .kaleid(() => ss.parameters.kaleid);\n  }\n}\n\nfunction getBuffersBySourceIndex(i: number) {\n  return [\n    [o1, o2],\n    [o2, o1],\n  ][i];\n}\nexport function runSource(s: State, i: number, screenRatio: number, lfo: LFO) {\n  const ss = s.sources[i];\n  const [o, modulationSource] = getBuffersBySourceIndex(i);\n  const source = getSource(ss, screenRatio, lfo);\n  source\n    .blend(o, getValueGenerator(ss, 'feedback', lfo))\n    .rotate(getValueGenerator(ss, 'rotation', lfo), 0)\n    .pixelate(getValueGenerator(ss, 'pixelate', lfo), getValueGenerator(ss, 'pixelate', lfo))\n    .scale(getValueGenerator(ss, 'scale', lfo))\n    .colorama(getValueGenerator(ss, 'colorama', lfo))\n    .modulate(src(modulationSource), getValueGenerator(ss, 'modulate', lfo))\n    .modulateRotate(\n      src(modulationSource),\n      getValueGenerator(ss, 'modulateRotate', lfo),\n      getValueGenerator(ss, 'modulateRotate', lfo)\n    )\n    .modulateScale(src(modulationSource), getValueGenerator(ss, 'modulateScale', lfo))\n    .modulate(o, getValueGenerator(ss, 'selfModulate', lfo))\n    .repeat(getValueGenerator(ss, 'repeatXY', lfo), getValueGenerator(ss, 'repeatXY', lfo))\n    .brightness(getValueGenerator(ss, 'brightness', lfo))\n    .out(o);\n}\nexport default function run(state: State, screenRatio: number, lfo1: LFO) {\n  runSource(state, 0, screenRatio, lfo1);\n  runSource(state, 1, screenRatio, lfo1);\n\n  solid(0, 0, 0, 0)\n    .blend(src(o1), getValueGenerator(state.sources[0], 'blend', lfo1))\n    .blend(src(o2), getValueGenerator(state.sources[1], 'blend', lfo1))\n    .diff(solid(0, 0, 0, 0).blend(src(o1), getValueGenerator(state.sources[0], 'diff', lfo1)))\n    .diff(solid(0, 0, 0, 0).blend(src(o2), getValueGenerator(state.sources[1], 'diff', lfo1)))\n    .out(o0);\n}\n","import { Subject } from 'rxjs/internal/Subject';\nimport { Parameter, SourceType } from '../types';\n\nexport type ParameterChangeEvent = {\n  parameter: Parameter;\n  value: number;\n  sourceIndex: number;\n};\n\nexport type SourceTypeChange = {\n  sourceIndex:number;\n  type: SourceType;\n}\n\nexport default class Streams {\n  parameterChange = new Subject<ParameterChangeEvent>();\n  lfoChange = new Subject<ParameterChangeEvent>();\n  sourceTypeChange = new Subject<SourceTypeChange>();\n  loadPreset = new Subject<number>();\n  savePreset = new Subject<number>();\n}\n","import { SourceState, SourceType } from '../../types';\nconst defaultParams = {\n  rotation: 0,\n  // kaleid: 1,\n  brightness: 0,\n  pixelate: 1500,\n  scale: 1,\n  colorama: 0,\n  modulate: 0,\n  modulateRotate: 0,\n  modulateScale: 0,\n  repeatXY: 1,\n  blend: 1,\n  diff: 0,\n  feedback: 0,\n  selfModulate: 0,\n};\nconst defaultSourceMods = {\n  [SourceType.osc]: {\n    mod1: 40,\n    mod2: 0,\n    mod3: 0,\n  },\n  [SourceType.noise]: {\n    mod1: 0,\n    mod2: 0.8,\n    mod3: 0,\n  },\n  [SourceType.voronoi]: {\n    mod1: 0,\n    mod2: 0,\n    mod3: 0,\n  },\n  [SourceType.screen]: {\n    mod1: 1,\n    mod2: 1,\n    mod3: 1,\n  },\n  [SourceType.shape]: {\n    mod1: 3,\n    mod2: 0.3,\n    mod3: 0,\n  },\n};\nexport const generateDefaultSourceState = (sourceType: SourceType, primary: boolean = true): SourceState => {\n  const res = new SourceState(\n    {\n      ...defaultSourceMods[sourceType],\n      ...defaultParams,\n    },\n    sourceType\n  );\n  res.parameters.blend = primary ? res.parameters.blend : 0;\n  return res;\n};\n","import { Mapping } from '../types';\n\nconst config: Mapping = {\n  sources: [\n    {\n      parameters: {\n        blend: { cc: 77 },\n        diff: { cc: 78 },\n        feedback: { cc: 79 },\n        selfModulate: { cc: 80 },\n        mod1: { cc: 13 },\n        mod2: { cc: 14 },\n        mod3: { cc: 15 },\n        brightness: { cc: 16 },\n        rotation: { cc: 29 },\n        pixelate: { cc: 30 },\n        scale: { cc: 31 },\n        colorama: { cc: 32 },\n        modulate: { cc: 49 },\n        modulateRotate: { cc: 50 },\n        modulateScale: { cc: 51 },\n        repeatXY: { cc: 52 },\n      },\n      switchSource: { note: 'F2' },\n      reset: { note: 'F#2' },\n    },\n    {\n      parameters: {\n        blend: { cc: 81 },\n        diff: { cc: 82 },\n        feedback: { cc: 83 },\n        selfModulate: { cc: 84 },\n        mod1: { cc: 17 },\n        mod2: { cc: 18 },\n        mod3: { cc: 19 },\n        brightness: { cc: 20 },\n        rotation: { cc: 33 },\n        pixelate: { cc: 34 },\n        scale: { cc: 35 },\n        colorama: { cc: 36 },\n        modulate: { cc: 53 },\n        modulateRotate: { cc: 54 },\n        modulateScale: { cc: 55 },\n        repeatXY: { cc: 56 },\n      },\n      switchSource: { note: 'A3' },\n      reset: { note: 'A#3' },\n    },\n  ],\n  shift: { note: 'C8' },\n  lfo1: { note: 'B7' },\n  presets: [\n    { note: 'C#5' },\n    { note: 'D5' },\n    { note: 'D#5' },\n    { note: 'E5' },\n    { note: 'F6' },\n    { note: 'F#6' },\n    { note: 'G6' },\n    { note: 'G#6' },\n  ],\n};\n\nexport default config;\n","import { Input } from 'rmidi';\nimport { config } from '../config/parameterConfig';\nimport { Parameter, MidiCCBinding, SourceMapping, SourceType, State, SourceTypeValues } from '../types';\nimport { generateDefaultSourceState } from './state/defaultSourceState';\nimport mapping from '../config/LaunchControlXL';\nimport { Subscription } from 'rxjs';\nimport Streams from './Streams';\n\nlet sourceSubscriptions: Subscription[] = [];\nlet input = Input.create('Launch Control XL');\n\nfunction bindParameter(\n  i: Input,\n  sourceIndex: number,\n  mapping: MidiCCBinding,\n  p: Parameter,\n  s: State,\n  subjects: Streams,\n  isLfoPressed: () => boolean\n) {\n  return i.cc(mapping.cc, mapping.channel).subscribe((e) => {\n    const ss = s.sources[sourceIndex];\n    if (isLfoPressed()) {\n      // send LFO to param\n      ss.lfo[p] = e.value / 127; // always between 0 and 1\n      subjects.lfoChange.next({ value: ss.lfo[p], parameter: p, sourceIndex });\n    } else {\n      const { min, max } = // mod1/2/3 change between source types\n        p === 'mod1' || p === 'mod2' || p === 'mod3' ? config.sourceMods[ss.sourceType][p] : config.parameters[p];\n      const unit = (max - min) / 127;\n      ss.parameters[p] = min + unit * e.value;\n      subjects.parameterChange.next({ value: ss.parameters[p], parameter: p, sourceIndex });\n    }\n  });\n}\n\nfunction bindSource(\n  i: Input,\n  s: State,\n  sourceIndex: number,\n  mapping: SourceMapping,\n  refreshState: () => void,\n  subjects: Streams\n) {\n  const ss = s.sources[sourceIndex];\n  const subs = Object.keys(ss.parameters).map((k) => {\n    const key = k as Parameter;\n    return bindParameter(i, sourceIndex, mapping.parameters[key], key, s, subjects, () => s.lfo1);\n  });\n\n  // switch source\n  subs.push(\n    i.noteOn(mapping.switchSource.note, mapping.switchSource.channel).subscribe(() => {\n      ss.sourceType = ((Number(ss.sourceType) + 1) % SourceTypeValues.length) as SourceType;\n\n      const defaultParams = generateDefaultSourceState(ss.sourceType).parameters;\n      Object.keys(ss.parameters)\n        .filter((p) => !['blend', 'diff'].includes(p))\n        .forEach((p) => (ss.parameters[p as Parameter] = defaultParams[p as Parameter]));\n      // refreshState();\n\n      subjects.sourceTypeChange.next({ type: ss.sourceType, sourceIndex });\n    })\n  );\n\n  // reset\n  subs.push(\n    i.noteOn(mapping.reset.note, mapping.reset.channel).subscribe(() => {\n      const defaultState = generateDefaultSourceState(ss.sourceType);\n      // copy parameters default state\n      Object.keys(ss.parameters).forEach((k) => {\n        const key = k as Parameter;\n        ss.parameters[key] = defaultState.parameters[key];\n      });\n    })\n  );\n\n  return subs;\n}\n\nexport function setupSources(state: State, refreshState: () => void, subjects: Streams) {\n  // clear previous setup\n  sourceSubscriptions.forEach((s) => s.unsubscribe());\n\n  //midi\n  // listInputs();\n  input.then((i) => {\n    sourceSubscriptions = [\n      ...bindSource(i, state, 0, mapping.sources[0], refreshState, subjects),\n      ...bindSource(i, state, 1, mapping.sources[1], refreshState, subjects),\n    ];\n\n    // debug\n    // i.noteOn().subscribe((e) => {\n    //   console.log(`${e.note.name}${e.note.octave}`);\n    // });\n  });\n}\n\nfunction bindBoolean(i: Input, state: State, k: 'lfo1' | 'shift', note: string, channel?: number): Subscription[] {\n  return [\n    i.noteOn(mapping[k].note, mapping[k].channel).subscribe(() => {\n      state[k] = true;\n      // console.log(`${k} down`);\n    }),\n    i.noteOff(mapping[k].note, mapping[k].channel).subscribe(() => {\n      state[k] = false;\n      // console.log(`${k} up`);\n    }),\n  ];\n}\n\nexport function setupPresets(\n  state: State,\n  savePreset: (index: number) => void,\n  loadPreset: (index: number) => void,\n  subjects: Streams\n) {\n  input.then((i) => {\n    bindBoolean(i, state, 'shift', mapping.shift.note, mapping.shift.channel);\n    bindBoolean(i, state, 'lfo1', mapping.lfo1.note, mapping.lfo1.channel);\n    mapping.presets.forEach((preset, index) => {\n      i.noteOn(preset.note, preset.channel).subscribe(() => {\n        if (state.shift) {\n          savePreset(index);\n          subjects.savePreset.next(index);\n        } else {\n          loadPreset(index);\n          subjects.loadPreset.next(index);\n        }\n      });\n    });\n  });\n}\n","import gsap from 'gsap';\nimport moment from 'moment';\nimport { config } from '../config/parameterConfig';\nimport { downloadObjectAsJson, loadFile } from '../storage';\nimport { Parameter, SourceState, SourceType, State } from '../types';\nimport { LFO } from './LFO';\nimport run, { runSource } from './runHydra';\nimport Streams from './Streams';\nimport { setupSources, setupPresets } from './setupMidi';\nimport { generateDefaultSourceState } from './state/defaultSourceState';\n// import { merge } from 'rxjs';\n\nexport class Engine {\n  state: State;\n  streams = new Streams();\n  screenRatio: number = 1;\n  lfo1 = new LFO();\n  constructor() {\n    this.state = {\n      sources: [generateDefaultSourceState(SourceType.osc), generateDefaultSourceState(SourceType.osc, false)],\n      presets: [],\n      shift: false,\n      lfo1: false,\n    };\n    this.savePreset = this.savePreset.bind(this);\n    this.loadPreset = this.loadPreset.bind(this);\n  }\n  init() {\n    setupSources(this.state, () => run(this.state, this.screenRatio, this.lfo1), this.streams);\n    setupPresets(this.state, this.savePreset, this.loadPreset, this.streams);\n    this.streams.sourceTypeChange.subscribe((e) => {\n      runSource(this.state, e.sourceIndex, this.screenRatio, this.lfo1);\n    });\n\n    // debug\n    // merge(\n    //   engine.scopeSubjects.sourceTypeChange,\n    //   engine.scopeSubjects.parameterChange,\n\n    //   engine.scopeSubjects.loadPreset,\n    //   engine.scopeSubjects.savePreset\n    // ).subscribe((e) => console.log(e));\n  }\n  run(screenRatio?: number) {\n    if (screenRatio) {\n      this.screenRatio = screenRatio;\n    }\n    run(this.state, this.screenRatio, this.lfo1);\n  }\n  randomize() {\n    Object.keys(this.state.sources[0].parameters).forEach((k) => {\n      if (k.startsWith('modulate')) {\n        return;\n      }\n      if (Math.random() < 0.5) {\n        const key = k as Parameter;\n        this.state.sources[0].parameters[key] =\n          Math.random() * (config.parameters[key].max - config.parameters[key].min + 1) + config.parameters[key].min;\n        this.state.sources[1].parameters[key] =\n          Math.random() * (config.parameters[key].max - config.parameters[key].min + 1) + config.parameters[key].min;\n      }\n    });\n  }\n\n  savePreset(index: number) {\n    this.state.presets[index] = [\n      this.cloneSourceState(this.state.sources[0]),\n      this.cloneSourceState(this.state.sources[1]),\n    ];\n  }\n\n  loadPreset(index: number) {\n    if (!this.state.presets[index] || this.state.presets[index].length !== this.state.sources.length) {\n      return;\n    }\n    const rerun = this.state.presets[index].some((p, i) => p.sourceType !== this.state.sources[i].sourceType);\n    this.state.sources.forEach((s, i) => {\n      const preset = this.state.presets[index][i];\n      s.sourceType = preset.sourceType;\n      gsap.to(s.parameters, {\n        ...preset.parameters,\n        duration: 0.001,\n        repeat: 0,\n      });\n    });\n    if (rerun) {\n      run(this.state, this.screenRatio, this.lfo1);\n    }\n  }\n\n  saveProject() {\n    downloadObjectAsJson(JSON.stringify(this.state, null, 2), moment().format('YYYY-MM-DD_hh-mm-ss'));\n  }\n\n  loadProject(file: File) {\n    loadFile(file)\n      .then((str) => {\n        try {\n          const state = JSON.parse(str) as State;\n          this.state = state;\n          setupSources(this.state, () => run(this.state, this.screenRatio, this.lfo1), this.streams);\n          run(this.state, this.screenRatio, this.lfo1);\n        } catch (err) {\n          console.error('failed to parse file', err);\n        }\n      })\n      .catch((err) => {\n        console.error('failed to read file', err);\n      });\n  }\n\n  private cloneSourceState(s: SourceState): SourceState {\n    return new SourceState({ ...s.parameters }, s.sourceType);\n  }\n}\n\nexport const engine = new Engine();\n","\nexport function loadFile(file: File): Promise<string> {\n  // Check if the file is an image.\n  //   if (file.type && file.type.indexOf('json') === -1) {\n  // console.log('File is not a project file.', file.type, file);\n  // return;\n  //   }\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.addEventListener('load', (event) => {\n      resolve(event.target?.result as string);\n    });\n    reader.readAsText(file);\n  });\n}\n\nexport function downloadObjectAsJson(data: string, name: string) {\n  var dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(data);\n  var downloadAnchorNode = document.createElement('a');\n  downloadAnchorNode.setAttribute('href', dataStr);\n  downloadAnchorNode.setAttribute('download', name + '.json');\n  document.body.appendChild(downloadAnchorNode); // required for firefox\n  downloadAnchorNode.click();\n  downloadAnchorNode.remove();\n}\n","import React, { useEffect, useRef, useState } from 'react';\nimport styled from 'styled-components';\nimport { engine } from '../engine';\nconst Hydra = require('hydra-synth');\n\nconst Canvas = styled.canvas`\n  height: 100%;\n  width: 100%;\n`;\n\nexport default () => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [hasRun, setHasRun] = useState(false);\n  useEffect(() => {\n    if (canvasRef.current && !hasRun) {\n      const w = window.innerWidth;\n      const h = window.innerHeight;\n      canvasRef.current.width = w;\n      canvasRef.current.height = h;\n      const hydra = new Hydra({\n        canvas: canvasRef.current,\n        // makeGlobal: false,\n        //   precision: 'highp',\n      });\n      hydra.setResolution(w, h);\n      engine.run(w / h);\n      setHasRun(false);\n    }\n  }, [canvasRef, hasRun]);\n\n  return <Canvas id=\"hydra-canvas\" ref={canvasRef} />;\n};\n","import React, { useCallback, useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { engine } from '../engine';\nimport { SourceType } from '../types';\nimport { merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nconst Container = styled.div`\n  position: absolute;\n  left: 0;\n  right: 0;\n  text-align: center;\n  bottom: 20vh;\n  font-size: 5vh;\n  text-shadow: 2px 2px 2px #111;\n  // -webkit-text-stroke-width: 2px;\n  // -webkit-text-stroke-color: #111;\n\n  .text-1 {\n    color: #dcf;\n  }\n  .text-2 {\n    color: #dfc;\n  }\n`;\nconst Text = styled.div``;\nlet timers: NodeJS.Timeout[] = [];\ntype Props = {\n  enabled: boolean;\n};\nconst Scope: React.FC<Props> = ({ enabled }) => {\n  const [text1, setText1] = useState('');\n  const [text2, setText2] = useState('');\n  const show = useCallback(\n    (text: string, force: boolean = false) => {\n      const index = text.startsWith('2 - ') ? 1 : 0;\n      const setText = [setText1, setText2][index];\n\n      if (!enabled && !force) {\n        return;\n      }\n      setText(text);\n      if (timers[index]) {\n        clearTimeout(timers[index]);\n      }\n      timers[index] = setTimeout(() => {\n        setText('');\n      }, 1000);\n    },\n    [setText1, setText2, enabled]\n  );\n  useEffect(() => {\n    const sub = merge(\n      engine.streams.sourceTypeChange.pipe(map((e) => `${e.sourceIndex + 1} - ${SourceType[e.type].toString()}`)),\n      engine.streams.parameterChange.pipe(\n        map((e) => `${e.sourceIndex + 1} - ${e.parameter}: ${e.value.toFixed(2)}`)\n      ),\n      engine.streams.lfoChange.pipe(\n        map((e) => `${e.sourceIndex + 1} - LFO - ${e.parameter}: ${Math.floor(e.value * 100)}%`)\n      ),\n      engine.streams.loadPreset.pipe(map((i) => `Load preset ${i + 1}`)),\n      engine.streams.savePreset.pipe(map((i) => `Save preset ${i + 1}`))\n    ).subscribe(show);\n    return () => sub.unsubscribe();\n  }, [show]);\n  useEffect(() => {\n    show(`Scope ${enabled ? 'on' : 'off'}`, true);\n  }, [enabled, show]);\n  return (\n    <Container>\n      <Text className=\"text-1\">{text1}</Text>\n      <Text className=\"text-2\">{text2}</Text>\n    </Container>\n  );\n};\nexport default Scope;\n","import React, { ChangeEvent, useEffect, useState } from 'react';\nimport './App.css';\nimport Hydra from './components/Hydra';\nimport styled from 'styled-components';\nimport { engine } from './engine/engine';\nimport Scope from './components/Scope';\n\nconst Container = styled.div`\n  height: 100%;\n  width: 100%;\n  position: relative;\n`;\n\nfunction loadFile(evt: ChangeEvent<HTMLInputElement>) {\n  if (evt.target.files && evt.target.files?.length > 0) {\n    engine.loadProject(evt.target.files[0]);\n  }\n}\nconst FileDrop = styled.input`\n  display: none;\n`;\n\nfunction App() {\n  const [scopeEnabled, setScopeEnabled] = useState(true);\n\n  useEffect(() => {\n    function keyPress(evt: KeyboardEvent) {\n      const k = evt.key.toLowerCase();\n      if (k === 's') {\n        engine.saveProject();\n      } else if (k === 'l') {\n        document.getElementById('file-selector')?.click();\n      } else if (k === 'r') {\n        engine.randomize();\n      } else if (k === 'i') {\n        setScopeEnabled((enabled) => !enabled);\n      }\n    }\n\n    window.addEventListener('keypress', keyPress);\n  }, [setScopeEnabled]);\n\n  return (\n    <Container>\n      <Hydra />\n      <Scope enabled={scopeEnabled} />\n      <FileDrop type=\"file\" id=\"file-selector\" accept=\".json\" onChange={(e) => loadFile(e)} />\n    </Container>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import { engine } from \"./engine\";\n\nexport default function init(){\n    engine.init();\n}","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport init from './init';\n\ninit();\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","export * from './hydra';\nexport * from './source';\nexport * from './mapping';\nexport * from './state';\nexport * from './parameters';\n","\n\nexport enum SourceType {\n  osc = 0,\n  noise,\n  voronoi,\n  shape,\n  screen,\n}\n\nexport const SourceTypeValues = Object.keys(SourceType).filter((k) => isNaN(Number(k)));\n","import { SourceType } from './source';\nimport { Parameter } from './parameters';\n\nexport class SourceState {\n  parameters!: Record<Parameter, number>;\n  sourceType!: SourceType;\n  lfo!: Record<Parameter, number>;\n  constructor(parameters: Record<Parameter, number>, sourceType: SourceType) {\n    this.parameters = parameters;\n    this.sourceType = sourceType;\n    this.lfo = { ...parameters };\n    Object.keys(this.lfo).forEach((k) => (this.lfo[k as Parameter] = 0));\n  }\n}\n\nexport type State = {\n  sources: SourceState[];\n  presets: SourceState[][];\n  shift: boolean;\n  lfo1: boolean;\n};\n"],"sourceRoot":""}