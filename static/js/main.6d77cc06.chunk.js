(this.webpackJsonplernie=this.webpackJsonplernie||[]).push([[0],{115:function(e,t,n){},116:function(e,t,n){},14:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return i}));var r,a=n(22),o=n(9),c={parameters:{mod1:{min:0,max:80},mod2:{min:-.5,max:.5},mod3:{min:0,max:10},rotation:{min:0,max:6.283185307179586},brightness:{min:-1,max:1},pixelate:{min:10,max:1500},scale:{min:.5,max:7},colorama:{min:-.001,max:1},modulate:{min:-1,max:1},modulateRotate:{min:-10,max:10},modulateScale:{min:-10,max:10},repeatXY:{min:1,max:8},blend:{min:0,max:1},diff:{min:0,max:1},feedback:{min:0,max:1},selfModulate:{min:0,max:1}},sourceMods:(r={},Object(a.a)(r,o.SourceType.osc,{mod1:{min:0,max:100},mod2:{min:-1,max:1},mod3:{min:0,max:6.3}}),Object(a.a)(r,o.SourceType.noise,{mod1:{min:0,max:1},mod2:{min:0,max:.5},mod3:{min:0,max:10}}),Object(a.a)(r,o.SourceType.voronoi,{mod1:{min:0,max:80},mod2:{min:0,max:10},mod3:{min:0,max:20}}),Object(a.a)(r,o.SourceType.screen,{mod1:{min:0,max:1},mod2:{min:0,max:1},mod3:{min:0,max:1}}),Object(a.a)(r,o.SourceType.shape,{mod1:{min:1,max:20},mod2:{min:0,max:1},mod3:{min:-100,max:100}}),r)},i=Object.keys(c.parameters).map((function(e){return e}))},167:function(e,t,n){"use strict";n.r(t);var r=n(4),o=n.n(r),c=n(104),i=n.n(c),s=(n(115),n(46)),u=n(44),d=(n(116),n(45)),f=n(38),m=n(43),l=n(59),p=n(110),h=n(105),b=n.n(h),v=n(14);var j=n(9),O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Object(m.a)(this,e),this.div=void 0,this.div=t}return Object(l.a)(e,[{key:"getValue",value:function(e){return(Math.sin(e/this.div)+1)/2}}]),e}();function y(e,t,n){return function(r){var o=r.time,c=e.parameters[t],i=v.b.parameters[t].max-v.b.parameters[t].min;return n.forEach((function(n,r){var a=e.lfos[r][t]<0?1-n.getValue(o):n.getValue(o);c+=a*Math.abs(e.lfos[r][t])*i})),c+=e.audio[t]*i*a.fft[0],c=Math.min(Math.max(v.b.parameters[t].min,c),v.b.parameters[t].max)}}function x(e,t,n,r){switch(e.sourceType){case j.SourceType.noise:return function(e,t,n){return noise(80,y(e,"mod1",n)).scale(1,1,t).contrast(y(e,"mod2",n))}(e,n,r);case j.SourceType.voronoi:return function(e,t,n){return voronoi(100,y(e,"mod1",n),y(e,"mod2",n)).scale(1,1,t)}(e,n,r);case j.SourceType.screen:return function(e,t,n,r){return t.initScreen(),src(t).color(y(e,"mod1",r),y(e,"mod2",r),y(e,"mod3",r))}(e,t,0,r);case j.SourceType.shape:return function(e,t,n){return shape(y(e,"mod1",n),y(e,"mod2",n)).scale(1,1,t).rotate((function(t){return t.time*e.parameters.mod3%360*(Math.PI/180)}))}(e,n,r);default:return function(e,t){return osc(y(e,"mod1",t),y(e,"mod2",t),y(e,"mod3",t))}(e,r)}}function S(e,t,n,r){var a=e.sources[t],o=function(e){return[o1,o2][e]}(t),c=function(e){return[s0,s1][e]}(t),i=function(e){return[o2,o1][e]}(t);x(a,c,n,r).blend(o,y(a,"feedback",r)).rotate(y(a,"rotation",r),0).pixelate((function(e){return y(a,"pixelate",r)(e)*n}),y(a,"pixelate",r)).scale(y(a,"scale",r)).colorama(y(a,"colorama",r)).modulate(src(i),y(a,"modulate",r)).modulateRotate(src(i),y(a,"modulateRotate",r),y(a,"modulateRotate",r)).modulateScale(src(i),y(a,"modulateScale",r)).modulate(o,y(a,"selfModulate",r)).repeat(y(a,"repeatXY",r),y(a,"repeatXY",r)).brightness(y(a,"brightness",r)).out(o)}function g(e,t,n){S(e,0,t,n),S(e,1,t,n),solid(0,0,0,0).blend(src(o1),y(e.sources[0],"blend",n)).blend(src(o2),y(e.sources[1],"blend",n)).diff(solid(0,0,0,0).blend(src(o1),y(e.sources[0],"diff",n))).diff(solid(0,0,0,0).blend(src(o2),y(e.sources[1],"diff",n))).out(o0)}var T=new function e(){Object(m.a)(this,e),this.parameterValueChange$=void 0,this.lfoDestinationValueChange$=void 0,this.audioDestinationValueChange$=void 0,this.clearParameter$=void 0,this.sourceTypeChange$=void 0,this.loadPreset$=void 0,this.savePreset$=void 0,this.keyDown$=void 0,this.keyUp$=void 0,this.resetSource$=void 0,this.selectAudioBin$=void 0},k=n(47),$=n(106),w={sources:[{parameters:{blend:{cc:77},diff:{cc:78},feedback:{cc:79},selfModulate:{cc:80},mod1:{cc:13},mod2:{cc:14},mod3:{cc:15},brightness:{cc:16},rotation:{cc:29},pixelate:{cc:30},scale:{cc:31},colorama:{cc:32},modulate:{cc:49},modulateRotate:{cc:50},modulateScale:{cc:51},repeatXY:{cc:52}},switchSource:{note:"F2"},reset:{note:"F#2"}},{parameters:{blend:{cc:81},diff:{cc:82},feedback:{cc:83},selfModulate:{cc:84},mod1:{cc:17},mod2:{cc:18},mod3:{cc:19},brightness:{cc:20},rotation:{cc:33},pixelate:{cc:34},scale:{cc:35},colorama:{cc:36},modulate:{cc:53},modulateRotate:{cc:54},modulateScale:{cc:55},repeatXY:{cc:56}},switchSource:{note:"A3"},reset:{note:"A#3"}}],keys:{shift:{note:"A7"},lfo1:{note:"B7"},lfo2:{note:"C8"},audio:{note:"A#7"}},presets:[{note:"C#5"},{note:"D5"},{note:"D#5"},{note:"E5"},{note:"F6"},{note:"F#6"},{note:"G6"},{note:"G#6"}]},P=n(74),I=n(20),C=n(10),M=$.Input.create("Launch Control XL"),R=function(e,t){return e.note==="".concat(t.note.name).concat(t.note.octave)&&(!e.channel||e.channel===t.channel)};var V,D,E,A,F,Y,L=n(22),N={rotation:0,brightness:0,pixelate:1500,scale:1,colorama:0,modulate:0,modulateRotate:0,modulateScale:0,repeatXY:1,blend:1,diff:0,feedback:0,selfModulate:0},B=(V={},Object(L.a)(V,j.SourceType.osc,{mod1:40,mod2:0,mod3:0}),Object(L.a)(V,j.SourceType.noise,{mod1:0,mod2:.8,mod3:0}),Object(L.a)(V,j.SourceType.voronoi,{mod1:0,mod2:0,mod3:0}),Object(L.a)(V,j.SourceType.screen,{mod1:1,mod2:1,mod3:1}),Object(L.a)(V,j.SourceType.shape,{mod1:3,mod2:.3,mod3:0}),V),X=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new j.SourceState(Object(f.a)(Object(f.a)({},B[e]),N),e);return n.parameters.blend=t?n.parameters.blend:0,n},J=new(function(){function e(){Object(m.a)(this,e),this.state=void 0,this.screenRatio=1,this.lfos=[new O,new O(2)],this.ranAudio=!1,this.keyState={lfo1:!1,lfo2:!1,shift:!1,audio:!1},this.state={sources:[X(j.SourceType.osc),X(j.SourceType.osc,!1)],presets:[]},this.savePreset=this.savePreset.bind(this),this.loadPreset=this.loadPreset.bind(this)}return Object(l.a)(e,[{key:"init",value:function(){var e=this;return function(e,t){var n=Object.keys(w.sources[0].parameters).map((function(e){return e}));return M.then((function(r){T.resetSource$=P.a.apply(void 0,Object(k.a)(w.sources.map((function(e,n){return r.noteOn(e.reset.note,e.reset.channel).pipe(Object(I.a)((function(){return!t.audio})),Object(C.a)((function(){return n})))})))),T.selectAudioBin$=P.a.apply(void 0,Object(k.a)(w.sources.map((function(e,n){return r.noteOn(e.reset.note,e.reset.channel).pipe(Object(I.a)((function(){return t.audio})),Object(C.a)((function(){return n})))})))),T.sourceTypeChange$=P.a.apply(void 0,Object(k.a)(w.sources.map((function(e,t){return r.noteOn(e.switchSource.note,e.switchSource.channel).pipe(Object(C.a)((function(){return t})))}))));var a=w.sources.map((function(e,t){return n.map((function(n){return r.cc(e.parameters[n].cc,e.parameters[n].channel).pipe(Object(C.a)((function(e){return{e:e,sourceIndex:t,p:n}})))}))})).flatMap((function(e){return e}));T.lfoDestinationValueChange$=P.a.apply(void 0,Object(k.a)(a.map((function(e){return e.pipe(Object(I.a)((function(){return(t.lfo1||t.lfo2)&&!t.shift})),Object(C.a)((function(e){var n=e.e,r=e.sourceIndex,a=e.p,o=t.lfo1?0:1;return{value:2*n.value/127-1,parameter:a,sourceIndex:r,lfoIndex:o}})))})))),T.parameterValueChange$=P.a.apply(void 0,Object(k.a)(a.map((function(n){return n.pipe(Object(I.a)((function(){return!(t.lfo1||t.lfo2||t.audio||t.shift)})),Object(C.a)((function(t){var n=t.e,r=t.sourceIndex,a=t.p,o="mod1"===a||"mod2"===a||"mod3"===a?v.b.sourceMods[e(r)][a]:v.b.parameters[a],c=o.min;return{value:c+(o.max-c)/127*n.value,parameter:a,sourceIndex:r}})))})))),T.audioDestinationValueChange$=P.a.apply(void 0,Object(k.a)(a.map((function(e){return e.pipe(Object(I.a)((function(){return t.audio&&!t.shift})),Object(C.a)((function(e){var t=e.e,n=e.sourceIndex,r=e.p;return{value:t.value/127,parameter:r,sourceIndex:n}})))})))),T.clearParameter$=P.a.apply(void 0,Object(k.a)(a.map((function(e){return e.pipe(Object(I.a)((function(){return t.shift})),Object(C.a)((function(e){var n=e.sourceIndex;return{parameter:e.p,sourceIndex:n,destination:t.lfo1?"lfo1":t.lfo2?"lfo2":t.audio?"audio":null}})))}))));var o=r.noteOn(),c=Object.keys(w.keys).map((function(e){return e}));T.keyDown$=o.pipe(Object(I.a)((function(e){return c.some((function(t){return R(w.keys[t],e)}))})),Object(C.a)((function(e){return c.find((function(t){return R(w.keys[t],e)}))}))),T.keyUp$=r.noteOff().pipe(Object(I.a)((function(e){return c.some((function(t){return R(w.keys[t],e)}))})),Object(C.a)((function(e){return c.find((function(t){return R(w.keys[t],e)}))}))),T.loadPreset$=o.pipe(Object(I.a)((function(e){return w.presets.some((function(t){return R(t,e)}))})),Object(C.a)((function(e){return w.presets.findIndex((function(t){return R(t,e)}))}))),T.savePreset$=o.pipe(Object(I.a)((function(e){return t.shift&&w.presets.some((function(t){return R(t,e)}))})),Object(C.a)((function(e){return w.presets.findIndex((function(t){return R(t,e)}))})))}))}((function(t){return e.state.sources[t].sourceType}),this.keyState).then((function(){T.savePreset$.subscribe((function(t){return e.savePreset(t)})),T.loadPreset$.subscribe((function(t){return e.loadPreset(t)})),T.sourceTypeChange$.subscribe((function(t){var n=e.state.sources[t];n.sourceType=(Number(n.sourceType)+1)%j.SourceTypeValues.length;var r=X(n.sourceType).parameters;v.a.filter((function(e){return!["blend","diff"].includes(e)})).forEach((function(e){return n.parameters[e]=r[e]})),S(e.state,t,e.screenRatio,e.lfos)})),T.keyDown$.subscribe((function(t){return e.keyState[t]=!0})),T.keyUp$.subscribe((function(t){return e.keyState[t]=!1})),T.parameterValueChange$.subscribe((function(t){return e.state.sources[t.sourceIndex].parameters[t.parameter]=t.value})),T.lfoDestinationValueChange$.subscribe((function(t){return e.state.sources[t.sourceIndex].lfos[t.lfoIndex][t.parameter]=t.value})),T.audioDestinationValueChange$.subscribe((function(t){return e.state.sources[t.sourceIndex].audio[t.parameter]=t.value})),T.resetSource$.subscribe((function(t){var n=e.state.sources[t],r=X(n.sourceType);v.a.forEach((function(e){n.parameters[e]=r.parameters[e],n.lfos.forEach((function(t){return t[e]=0}))}))})),T.clearParameter$.subscribe((function(t){var n=e.state.sources[t.sourceIndex];"lfo1"===t.destination?n.lfos[0][t.parameter]=0:"lfo2"===t.destination?n.lfos[1][t.parameter]=0:"audio"===t.destination?n.audio[t.parameter]=0:n.parameters[t.parameter]=X(n.sourceType).parameters[t.parameter]})),T.selectAudioBin$.subscribe((function(t){e.ranAudio||(e.ranAudio=!0,navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){var t=a.context.createMediaStreamSource(e);a.setSmooth(.5),a.meyda.setSource(t)})),a.show())}))}))}},{key:"run",value:function(e){e&&(this.screenRatio=e),g(this.state,this.screenRatio,this.lfos)}},{key:"randomize",value:function(){var e=this;v.a.forEach((function(t){if(!t.startsWith("modulate")&&Math.random()<.5){var n=t;e.state.sources[0].parameters[n]=Math.random()*(v.b.parameters[n].max-v.b.parameters[n].min+1)+v.b.parameters[n].min,e.state.sources[1].parameters[n]=Math.random()*(v.b.parameters[n].max-v.b.parameters[n].min+1)+v.b.parameters[n].min}}))}},{key:"savePreset",value:function(e){this.state.presets[e]=[this.cloneSourceState(this.state.sources[0]),this.cloneSourceState(this.state.sources[1])]}},{key:"loadPreset",value:function(e){var t=this;if(this.state.presets[e]&&this.state.presets[e].length===this.state.sources.length){var n=this.state.presets[e].some((function(e,n){return e.sourceType!==t.state.sources[n].sourceType}));this.state.sources.forEach((function(n,r){var a=t.state.presets[e][r];n.sourceType=a.sourceType,p.a.to(n.parameters,Object(f.a)(Object(f.a)({},a.parameters),{},{duration:.001,repeat:0}))})),n&&g(this.state,this.screenRatio,this.lfos)}}},{key:"saveProject",value:function(){!function(e,t){var n="data:text/json;charset=utf-8,"+encodeURIComponent(e),r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",t+".json"),document.body.appendChild(r),r.click(),r.remove()}(JSON.stringify(this.state,null,2),b()().format("YYYY-MM-DD_hh-mm-ss"))}},{key:"loadProject",value:function(e){var t=this;(function(e){return new Promise((function(t,n){var r=new FileReader;r.addEventListener("load",(function(e){var n;t(null===(n=e.target)||void 0===n?void 0:n.result)})),r.readAsText(e)}))})(e).then((function(e){try{var n=JSON.parse(e);t.state=n,g(t.state,t.screenRatio,t.lfos)}catch(r){console.error("failed to parse file",r)}})).catch((function(e){console.error("failed to read file",e)}))}},{key:"cloneSourceState",value:function(e){return new j.SourceState(Object(f.a)({},e.parameters),e.sourceType)}}]),e}()),U=n(16),Z=n(124),z=d.a.canvas(D||(D=Object(u.a)(["\n  height: 100%;\n  width: 100%;\n"]))),W=function(){var e=Object(r.useRef)(null),t=Object(r.useState)(!1),n=Object(s.a)(t,2),a=n[0],o=n[1];return Object(r.useEffect)((function(){if(e.current&&!a){var t=window.innerWidth,n=window.innerHeight;e.current.width=t,e.current.height=n,new Z({canvas:e.current}).setResolution(t,n),J.run(t/n),o(!1)}}),[e,a]),Object(U.jsx)(z,{id:"hydra-canvas",ref:e})},G=d.a.div(E||(E=Object(u.a)(["\n  position: absolute;\n  left: 0;\n  right: 0;\n  text-align: center;\n  bottom: 20vh;\n  font-size: 5vh;\n  text-shadow: 2px 2px 2px #111;\n  // -webkit-text-stroke-width: 2px;\n  // -webkit-text-stroke-color: #111;\n\n  .text-1 {\n    color: #dcf;\n  }\n  .text-2 {\n    color: #dfc;\n  }\n"]))),H=d.a.div(A||(A=Object(u.a)([""]))),_=[],q=function(e){var t=e.enabled,n=Object(r.useState)(""),a=Object(s.a)(n,2),o=a[0],c=a[1],i=Object(r.useState)(""),u=Object(s.a)(i,2),d=u[0],f=u[1],m=Object(r.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.startsWith("2 - ")?1:0,a=[c,f][r];(t||n)&&(a(e),_[r]&&clearTimeout(_[r]),_[r]=setTimeout((function(){a("")}),1e3))}),[c,f,t]);return Object(r.useEffect)((function(){var e=Object(P.a)(T.sourceTypeChange$.pipe(Object(C.a)((function(e){return"".concat(e+1," - ").concat(j.SourceType[J.state.sources[e].sourceType].toString())}))),T.parameterValueChange$.pipe(Object(C.a)((function(e){return"".concat(e.sourceIndex+1," - ").concat(e.parameter,": ").concat(e.value.toFixed(2))}))),T.lfoDestinationValueChange$.pipe(Object(C.a)((function(e){return"".concat(e.sourceIndex+1," - LFO ").concat(e.lfoIndex+1," - ").concat(e.parameter,": ").concat(Math.floor(100*e.value),"%")}))),T.audioDestinationValueChange$.pipe(Object(C.a)((function(e){return"".concat(e.sourceIndex+1," - Audio - ").concat(e.parameter,": ").concat(Math.floor(100*e.value),"%")}))),T.loadPreset$.pipe(Object(C.a)((function(e){return"Load preset ".concat(e+1)}))),T.savePreset$.pipe(Object(C.a)((function(e){return"Save preset ".concat(e+1)}))),T.clearParameter$.pipe(Object(C.a)((function(e){return"".concat(e.sourceIndex+1," ").concat(e.destination?"- ".concat(e.destination):"","- ").concat(e.parameter," cleared")})))).subscribe(m);return function(){return e.unsubscribe()}}),[m]),Object(r.useEffect)((function(){m("Scope ".concat(t?"on":"off"),!0)}),[t,m]),Object(U.jsxs)(G,{children:[Object(U.jsx)(H,{className:"text-1",children:o}),Object(U.jsx)(H,{className:"text-2",children:d})]})},K=d.a.div(F||(F=Object(u.a)(["\n  height: 100%;\n  width: 100%;\n  position: relative;\n"])));var Q=d.a.input(Y||(Y=Object(u.a)(["\n  display: none;\n"])));var ee=function(){var e=Object(r.useState)(!0),t=Object(s.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)(!1),c=Object(s.a)(o,2),i=c[0],u=c[1];return Object(r.useEffect)((function(){window.addEventListener("keypress",(function(e){var t=e.key.toLowerCase();if("s"===t)J.saveProject();else if("l"===t){var n;null===(n=document.getElementById("file-selector"))||void 0===n||n.click()}else"r"===t?J.randomize():"i"===t&&a((function(e){return!e}))}))}),[a]),Object(r.useEffect)((function(){J.init().then((function(){return u(!0)}))}),[u]),i?Object(U.jsxs)(K,{children:[Object(U.jsx)(W,{}),Object(U.jsx)(q,{enabled:n}),Object(U.jsx)(Q,{type:"file",id:"file-selector",accept:".json",onChange:function(e){return function(e){var t;e.target.files&&(null===(t=e.target.files)||void 0===t?void 0:t.length)>0&&J.loadProject(e.target.files[0])}(e)}})]}):null},te=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,168)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),o(e),c(e)}))};i.a.render(Object(U.jsx)(o.a.StrictMode,{children:Object(U.jsx)(ee,{})}),document.getElementById("root")),te()},9:function(e,t,n){"use strict";var r=n(92);n.o(r,"SourceState")&&n.d(t,"SourceState",(function(){return r.SourceState})),n.o(r,"SourceType")&&n.d(t,"SourceType",(function(){return r.SourceType})),n.o(r,"SourceTypeValues")&&n.d(t,"SourceTypeValues",(function(){return r.SourceTypeValues}));var a=n(93);n.d(t,"SourceType",(function(){return a.a})),n.d(t,"SourceTypeValues",(function(){return a.b}));var o=n(94);n.o(o,"SourceState")&&n.d(t,"SourceState",(function(){return o.SourceState}));var c=n(95);n.d(t,"SourceState",(function(){return c.a}));n(96)},92:function(e,t){},93:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),function(e){e[e.osc=0]="osc",e[e.noise=1]="noise",e[e.voronoi=2]="voronoi",e[e.shape=3]="shape",e[e.screen=4]="screen"}(r||(r={}));var a=Object.keys(r).filter((function(e){return isNaN(Number(e))}))},94:function(e,t){},95:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(38),a=n(43),o=n(59),c=n(14),i=function(){function e(t,n){Object(a.a)(this,e),this.parameters=void 0,this.sourceType=void 0,this.lfos=void 0,this.audio=void 0,this.parameters=t,this.sourceType=n,this.lfos=[this.generateZeroParametersRecord(),this.generateZeroParametersRecord()],this.audio=this.generateZeroParametersRecord()}return Object(o.a)(e,[{key:"generateZeroParametersRecord",value:function(){var e=Object(r.a)({},this.parameters);return c.a.forEach((function(t){return e[t]=0})),e}}]),e}()},96:function(e,t){}},[[167,1,2]]]);
//# sourceMappingURL=main.6d77cc06.chunk.js.map